# 接口说明

# 目录

- [概述](#概述)
 - [接口基地址](#接口基地址)
 - [JsonResult类型说明](#jsonresult类型说明)
 - [Session类型说明](#session类型说明)
 - [LoginResult枚举值说明](#loginresult枚举值说明)
- [数据接口](#数据接口)
 - [写日志](#写日志)

# 概述

接口访问形式：GET、POST、PUT、DELETE。

## 接口验证

所有接口都需要验证，验证分两类：

1. 使用Session验证  
将构造的或保存的Session序列化为Json字符串，然后再进行Base64编码。

2. 使用接口传入参数和安全密钥验证  
将接口的第一个参数的值和Secret（预先约定的安全密钥）组成一个字符串，取MD5值并序列化后进行Base64编码。

验证数据由Request的Authorization头部承载。

## 版本信息和客户端类型

接口需要在Request头部的Accept写入版本号及客户端类型，此数据用于接口的版本兼容性校验。该信息应设置为如下值：
```
request.Accept = "application/x-gzip/json; version={Version}; client={type}";
```

客户端类型：

 - Desktop；
 - Browser(PC)；
 - iOS；
 - Android；
 - WindowsPhone；
 - Other
 - TYFQ(WeiXin)

[回目录](#目录)


## 接口基地址

http://192.168.17.104:8514/  
[回目录](#目录)

## JsonResult类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|bool|Successful|接口调用是否成功|
|string|Code|错误代码|
|string|Name|错误名|
|string|Message|错误消息，描述了接口调用失败原因|
|string|Data|接口返回数据(Json)|
[回目录](#目录)

## Session类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|int|ID|自增ID，用于下标查找|
|Guid|UserId|用户ID|
|string|UserName|用户名|
|string|OpenId|微信openid|
|string|LoginName|用户账号|
|string|Signature|用户签名|
|Guid|DeptId|用户登录部门ID（App无用）|
|string|DeptName|用户登录部门全称（App无用）|
|int|UserType|用户类型|
|bool|Validity|用户状态：true正常；false封禁|
|string|MachineId|用户设备码|
|int|FailureCount|连续验证失败次数，超过5次封禁1小时|
|DateTime|LastConnect|上次连接时间|
|LoginResult|LoginResult|用户登录/验证结果|
|bool|OnlineStatus|用户是否在线|
[回目录](#目录)

## LoginResult枚举值说明

|Code|Value|Description|
| ------------ | ------------ | ------------ |
|0|Success|登录成功|
|1|Multiple|账号已在其他设备登录|
|2|Online|账号已在此设备登录|
|3|Failure|登录失败(错误的登录密码)|
|4|Banned|账号被禁止登录和使用|
|5|NotExist|账号不存在|
|6|Unauthorized|在线用户已超最大用户数|
[回目录](#目录)

# 数据接口

## 日志

### 写日志

POST /logs

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|code + Secret（约定的密钥）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|code|订单ID|
|string|message|事件消息（可序列化成Json）|
|string|source|事件来源（预先定义）|
|string|action|操作名称|
|string|userid|用户ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。
  
[回目录](#目录)
